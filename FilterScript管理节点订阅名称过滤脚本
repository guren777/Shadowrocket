$server.reserved="1,40-60,30-50"



let customCharStart = "➥"; // 添加前缀（留空即不添加）
let customCharEnd = "🔫";     // 添加后缀（留空即不添加）

// 配置：输出语言选项，CN为中文名称，EN为英文名称（默认输出英文）
const outputLanguage = "CN"; // 选择 "CN" 或 "EN"

// 国家和地区与标识符的映射（支持中英文匹配）

const keywordsToNames = {
    "美国|美國|US|洛杉矶|洛杉磯|西雅图|纽约|芝加哥|Atlanta|States|American|Los Angeles|Seattle|New York|Chicago": outputLanguage === "EN" ? "🇺🇸US" : "🇺🇸美国",
    "港|香港|HK|Hong Kong": outputLanguage === "EN" ? "🇭🇰HK" : "🇭🇰香港",
    "新加坡|狮城|SG|Singapore": outputLanguage === "EN" ? "🇸🇬SG" : "🇸🇬新加坡",
    "台|台湾|台北|高雄|TW|Taiwan|Taipei|Kaohsiung": outputLanguage === "EN" ? "🌀TW" : "🌀台湾",
    "日|东京|大阪|名古屋|JP|Tokyo|Japan|Osaka|Nagoya": outputLanguage === "EN" ? "🇯🇵JP" : "🇯🇵日本",
    "韩国|首尔|釜山|KR|Korea|Seoul|Busan": outputLanguage === "EN" ? "🇰🇷KR" : "🇰🇷韩国",
    "土耳其|伊斯坦布尔|安卡拉|TR|Turkey|Istanbul|Ankara": outputLanguage === "EN" ? "🇹🇷TR" : "🇹🇷土耳其",
    "爱尔兰|都柏林|IE|Ireland|Dublin": outputLanguage === "EN" ? "🇮🇪IRL" : "🇮🇪爱尔兰",
    "澳|悉尼|墨尔本|布里斯班|AU|Australia|Sydney|Melbourne|Brisbane": outputLanguage === "EN" ? "🇦🇺AU" : "🇦🇺澳大利亚",
    "法国|巴黎|里昂|马赛|FR|France|Paris|Lyon|Marseille": outputLanguage === "EN" ? "🇫🇷FRA" : "🇫🇷法国",
    "瑞典|斯德哥尔摩|哥德堡|SE|Sweden|Stockholm|Gothenburg": outputLanguage === "EN" ? "🇸🇪SE" : "🇸🇪瑞典",
    "德国|法兰克福|柏林|慕尼黑|DE|Germany|Frankfurt|Berlin|Munich": outputLanguage === "EN" ? "🇩🇪DE" : "🇩🇪德国",
    "英国|伦敦|曼彻斯特|伯明翰|GB|UK|United Kingdom|London|Manchester|Birmingham": outputLanguage === "EN" ? "🇬🇧GB" : "🇬🇧英国",
    "印度|孟买|德里|班加罗尔|IN|India|Mumbai|Delhi|Bangalore": outputLanguage === "EN" ? "🇮🇳IN" : "🇮🇳印度",
    "加拿大|多伦多|温哥华|蒙特利尔|CA|Canada|Toronto|Vancouver|Montreal": outputLanguage === "EN" ? "🇨🇦CA" : "🇨🇦加拿大",
    "西班牙|马德里|巴塞罗那|ES|Spain|Madrid|Barcelona": outputLanguage === "EN" ? "🇪🇸ES" : "🇪🇸西班牙",
    "意大利|罗马|米兰|那不勒斯|IT|Italy|Rome|Milan|Naples": outputLanguage === "EN" ? "🇮🇹IT" : "🇮🇹意大利",
    "荷兰|阿姆斯特丹|鹿特丹|NL|Netherlands|Amsterdam|Rotterdam": outputLanguage === "EN" ? "🇳🇱NL" : "🇳🇱荷兰",
    "瑞士|苏黎世|日内瓦|CH|Switzerland|Zurich|Geneva": outputLanguage === "EN" ? "🇨🇭CH" : "🇨🇭瑞士",
    "俄罗斯|莫斯科|圣彼得堡|RU|Russia|Moscow|Saint Petersburg": outputLanguage === "EN" ? "🇷🇺RU" : "🇷🇺俄罗斯",
    "巴西|圣保罗|里约热内卢|BR|Brazil|São Paulo|Rio de Janeiro": outputLanguage === "EN" ? "🇧🇷BR" : "🇧🇷巴西",
    "南非|约翰内斯堡|开普敦|ZA|South Africa|Johannesburg|Cape Town": outputLanguage === "EN" ? "🇿🇦ZA" : "🇿🇦南非",
    "墨西哥|墨西哥城|瓜达拉哈拉|MX|Mexico|Mexico City|Guadalajara": outputLanguage === "EN" ? "🇲🇽MX" : "🇲🇽墨西哥",
    "阿根廷|布宜诺斯艾利斯|AR|Argentina|Buenos Aires": outputLanguage === "EN" ? "🇦🇷AR" : "🇦🇷阿根廷",
    "波兰|华沙|克拉科夫|PL|Poland|Warsaw|Krakow": outputLanguage === "EN" ? "🇵🇱PL" : "🇵🇱波兰",
    "泰国|曼谷|清迈|TH|Thailand|Bangkok|Chiang Mai": outputLanguage === "EN" ? "🇹🇭TH" : "🇹🇭泰国",
    "马来西亚|吉隆坡|槟城|MY|Malaysia|Kuala Lumpur|Penang": outputLanguage === "EN" ? "🇲🇾MY" : "🇲🇾马来西亚",
    "越南|河内|胡志明|VN|Vietnam|Hanoi|Ho Chi Minh": outputLanguage === "EN" ? "🇻🇳VN" : "🇻🇳越南",
    "菲律宾|马尼拉|PH|Philippines|Manila": outputLanguage === "EN" ? "🇵🇭PH" : "🇵🇭菲律宾",
    "埃及|开罗|EG|Egypt|Cairo": outputLanguage === "EN" ? "🇪🇬EG" : "🇪🇬埃及",
    "沙特|利雅得|吉达|SA|Saudi Arabia|Riyadh|Jeddah": outputLanguage === "EN" ? "🇸🇦SA" : "🇸🇦沙特阿拉伯",
    "阿联酋|迪拜|阿布扎比|AE|UAE|Dubai|Abu Dhabi": outputLanguage === "EN" ? "🇦🇪AE" : "🇦🇪阿联酋",
    "挪威|奥斯陆|NO|Norway|Oslo": outputLanguage === "EN" ? "🇳🇴NO" : "🇳🇴挪威",
    "芬兰|赫尔辛基|FI|Finland|Helsinki": outputLanguage === "EN" ? "🇫🇮FI" : "🇫🇮芬兰",
    "奥地利|维也纳|AT|Austria|Vienna": outputLanguage === "EN" ? "🇦🇹AT" : "🇦🇹奥地利",
    "希腊|雅典|GR|Greece|Athens": outputLanguage === "EN" ? "🇬🇷GR" : "🇬🇷希腊",
    "匈牙利|布达佩斯|HU|Hungary|Budapest": outputLanguage === "EN" ? "🇭🇺HU" : "🇭🇺匈牙利",
    "捷克|布拉格|CZ|Czech|Prague": outputLanguage === "EN" ? "🇨🇿CZ" : "🇨🇿捷克",
    "新西兰|奥克兰|NZ|New Zealand|Auckland": outputLanguage === "EN" ? "🇳🇿NZ" : "🇳🇿新西兰",
    "尼泊尔|加德满都|NP|Nepal|Kathmandu": outputLanguage === "EN" ? "🇳🇵NP" : "🇳🇵尼泊尔",
    "葡萄牙|里斯本|PT|Portugal|Lisbon": outputLanguage === "EN" ? "🇵🇹PT" : "🇵🇹葡萄牙",
    "巴基斯坦|伊斯兰堡|PK|Pakistan|Islamabad": outputLanguage === "EN" ? "🇵🇰PK" : "🇵🇰巴基斯坦",
    "伊朗|德黑兰|IR|Iran|Tehran": outputLanguage === "EN" ? "🇮🇷IR" : "🇮🇷伊朗",
    "伊拉克|巴格达|IQ|Iraq|Baghdad": outputLanguage === "EN" ? "🇮🇶IQ" : "🇮🇶伊拉克",
    "阿尔及利亚|阿尔及尔|DZ|Algeria|Algiers": outputLanguage === "EN" ? "🇩🇿DZ" : "🇩🇿阿尔及利亚",
    "摩洛哥|拉巴特|MA|Morocco|Rabat": outputLanguage === "EN" ? "🇲🇦MA" : "🇲🇦摩洛哥",
    "尼日利亚|拉各斯|NG|Nigeria|Lagos": outputLanguage === "EN" ? "🇳🇬NG" : "🇳🇬尼日利亚",
    "智利|圣地亚哥|CL|Chile|Santiago": outputLanguage === "EN" ? "🇨🇱CL" : "🇨🇱智利",
    "秘鲁|利马|PE|Peru|Lima": outputLanguage === "EN" ? "🇵🇪PE" : "🇵🇪秘鲁",
    "哥伦比亚|波哥大|CO|Colombia|Bogotá": outputLanguage === "EN" ? "🇨🇴CO" : "🇨🇴哥伦比亚",
    "罗马尼亚|Romania|RO|Bucharest|Cluj-Napoca|Timișoara": outputLanguage === "EN" ? "🇷🇴RO" : "🇷🇴罗马尼亚",
    "塞尔维亚|Serbia|RS|Belgrade|Novi Sad|Niš": outputLanguage === "EN" ? "🇷🇸RS" : "🇷🇸塞尔维亚",
    "立陶宛|Lithuania|LT|Vilnius|Kaunas|Klaipėda": outputLanguage === "EN" ? "🇱🇹LT" : "🇱🇹立陶宛",
    "危地马拉|Guatemala|GT|Guatemala City|Antigua Guatemala|Quetzaltenango": outputLanguage === "EN" ? "🇬🇹GT" : "🇬🇹危地马拉",
    "丹麦|Denmark|DK|Copenhagen|Aarhus|Odense": outputLanguage === "EN" ? "🇩🇰DK" : "🇩🇰丹麦",
    "乌克兰|Ukraine|UA|Kyiv|Lviv|Odesa": outputLanguage === "EN" ? "🇺🇦UA" : "🇺🇦乌克兰",
    "以色列|Israel|IL|Jerusalem|Tel Aviv|Haifa": outputLanguage === "EN" ? "🇮🇱IL" : "🇮🇱以色列",
    "厄瓜多尔|Ecuador|EC|Quito|Guayaquil|Cuenca": outputLanguage === "EN" ? "🇪🇨EC" : "🇪🇨厄瓜多尔",
    "哥斯达黎加|Costa Rica|CR|San José|Alajuela|Cartago": outputLanguage === "EN" ? "🇨🇷CR" : "🇨🇷哥斯达黎加",
    "塞浦路斯|Cyprus|CY|Nicosia|Limassol|Larnaca": outputLanguage === "EN" ? "🇨🇾CY" : "🇨🇾塞浦路斯",
    "比利时|Belgium|BE|Brussels|Antwerp|Ghent": outputLanguage === "EN" ? "🇧🇪BE" : "🇧🇪比利时",
    "玻利维亚|Bolivia|BO|Sucre|La Paz|Santa Cruz": outputLanguage === "EN" ? "🇧🇴BO" : "🇧🇴玻利维亚", "印尼|印度尼西亚|Indonesia|雅加达|巴厘岛|Jakarta|Bali": outputLanguage === "EN" ? "🇮🇩ID" : "🇮🇩印度尼西亚",
    "卡塔尔|多哈|Qatar|Doha": outputLanguage === "EN" ? "🇶🇦QA" : "🇶🇦卡塔尔",
    "科威特|Kuwait|科威特城|Kuwait City": outputLanguage === "EN" ? "🇰🇼KW" : "🇰🇼科威特",
    "保加利亚|索非亚|Sofia|Bulgaria": outputLanguage === "EN" ? "🇧🇬BG" : "🇧🇬保加利亚",
    "斯洛伐克|布拉迪斯拉发|Bratislava|Slovakia": outputLanguage === "EN" ? "🇸🇰SK" : "🇸🇰斯洛伐克",
    "克罗地亚|萨格勒布|Zagreb|Croatia": outputLanguage === "EN" ? "🇭🇷HR" : "🇭🇷克罗地亚",
    "斯洛文尼亚|卢布尔雅那|Ljubljana|Slovenia": outputLanguage === "EN" ? "🇸🇮SI" : "🇸🇮斯洛文尼亚",
    "爱沙尼亚|塔林|Tallinn|Estonia": outputLanguage === "EN" ? "🇪🇪EE" : "🇪🇪爱沙尼亚",
    "拉脱维亚|里加|Riga|Latvia": outputLanguage === "EN" ? "🇱🇻LV" : "🇱🇻拉脱维亚",
    "冰岛|雷克雅未克|Reykjavik|Iceland": outputLanguage === "EN" ? "🇮🇸IS" : "🇮🇸冰岛",
    "乌兹别克斯坦|塔什干|Tashkent|Uzbekistan": outputLanguage === "EN" ? "🇺🇿UZ" : "🇺🇿乌兹别克斯坦",
    "哈萨克斯坦|努尔苏丹|阿拉木图|Kazakhstan|Nur-Sultan|Almaty": outputLanguage === "EN" ? "🇰🇿KZ" : "🇰🇿哈萨克斯坦",
    "摩尔多瓦|基希讷乌|Chisinau|Moldova": outputLanguage === "EN" ? "🇲🇩MD" : "🇲🇩摩尔多瓦",
    "格鲁吉亚|第比利斯|Tbilisi|Georgia": outputLanguage === "EN" ? "🇬🇪GE" : "🇬🇪格鲁吉亚",
    "黑山|波德戈里察|Podgorica|Montenegro": outputLanguage === "EN" ? "🇲🇪ME" : "🇲🇪黑山","塞|塞舌尔|SC|Seychelles": outputLanguage === "EN" ? "🇸🇨SC" : "🇸🇨塞舌尔",
    "阿尔巴尼亚|地拉那|Tirana|Albania": outputLanguage === "EN" ? "🇦🇱AL" : "🇦🇱阿尔巴尼亚"

};

// 过滤关键词，防止无效或广告节点
const filterKeywords = [
  "广告", "过期", "无效", "测试", "备用", "官网", "账号", "有效期", "群",
  "到期", "刷新", "剩余", "电报", "会员", "解锁", "流量", "超时",
  "订阅", "佣金", "免翻", "节点", "下载", "更新", "点外", "重置",
  "免流", "Days", "Date", "Expire", "Premium", "建议", "免费",
  "套餐", "到期", "有效", "剩余", "版本", "已用", "过期", "失联",
  "测试", "官方", "网址", "备用", "群", "TEST", "客服", "网站",
  "获取", "订阅", "流量", "机场", "下次", "官址", "联系", "邮箱",
  "工单", "学术", "USE", "USED", "TOTAL", "EXPIRE", "EMAIL", "中国", "CN"
];

// 定义需要保留的关键词及其替换词
const keywordsMap = {
  "ChatGPT": "ChatGPT",
  "Netflix": "Netflix",
  "奈飞": "奈飞",
  "保留的关键词2": "替换词2" // 如有其他需要保留的关键词可按此格式添加
};

// 若服务器标题包含任一过滤关键词，则直接返回 false
if (filterKeywords.some(kw => new RegExp(kw, "i").test($server.title))) return false;

// 保留需跳过的关键词部分，同时移除它们
let preservedParts = [];
let newTitle = $server.title;
Object.keys(keywordsMap).forEach(kw => {
  const regex = new RegExp(kw, "i");
  const match = newTitle.match(regex);
  if (match) {
    preservedParts.push(keywordsMap[kw]);
    newTitle = newTitle.replace(regex, "");
  }
});

// 匹配区域关键词，并替换为对应标识符（找到第一个匹配项后退出）
for (const pattern in keywordsToNames) {
  if (new RegExp(pattern, "i").test(newTitle)) {
    newTitle = keywordsToNames[pattern];
    break;
  }
}

// 添加自定义前缀和后缀，并确保节点标题不重复
newTitle = customCharStart + newTitle;
const map = globalThis.map || (globalThis.map = {});
if (!map[newTitle]) {
  map[newTitle] = 1;
} else {
  newTitle = `${newTitle}-${++map[newTitle]}`;
}
newTitle += customCharEnd;

// 将保留的部分重新追加到标题末尾（如果有）
if (preservedParts.length) newTitle += " " + preservedParts.join(" ");

// 更新服务器标题
$server.title = newTitle;
return true;