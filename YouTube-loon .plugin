#!name= 𝐘𝐨𝐮𝐓𝐮𝐛𝐞🚫/⿻/▶︎ɢʀ版  
#!desc=Youtube & YouTube Music 去广告/画中画/后台播放，支持参数控制翻译及界面元素  
#!author=deezertidal  
#!icon=https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png  
#!homepage=  
#!tag=YouTube去广告  
#!system=iOS  
#!system_version=15.0  
#!loon_version=3.2.1(372)  

#!arguments=blockUpload:true,blockImmersive:true,captionLang:zh-Hans,lyricLang:zh-Hans,engine:auto,debug:false  
#!arguments-desc=- 参数说明：\nblockUpload / blockImmersive 为按钮屏蔽选项；\ncaptionLang / lyricLang 为翻译语言（语言代码）；\nengine 可选 jsc/webview/auto；\ndebug 为调试日志输出  

[Argument]
blockUpload = switch, true, tag=blockUpload, desc=是否屏蔽上传按钮
blockImmersive = switch, true, tag=blockImmersive, desc=是否屏蔽选段按钮
captionLang = input, zh-Hans, tag=captionLang, desc=设置字幕翻译语言（语言代码）
lyricLang = input, zh-Hans, tag=lyricLang, desc=设置歌词翻译语言（语言代码）
engine = select, auto, jsc, webview, tag=engine, desc=脚本执行引擎
debug = switch, false, tag=debug, desc=是否启用调试模式

[Rule]
# 屏蔽 UDP 协议下的 YouTube 广告/统计
AND,((DOMAIN-SUFFIX,googlevideo.com), (PROTOCOL,UDP)),REJECT
AND,((DOMAIN-SUFFIX,youtubei.googleapis.com), (PROTOCOL,UDP)),REJECT

[URL Rewrite]
# 拦截广告相关的 initplayback 请求返回空白图片
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad _ REJECT-IMG

[mock-response-body]
# 返回空内容（用于进一步拦截）
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad mock-response-body data-type=text status-code=502

[Script]
# 主处理脚本：拦截并修改 YouTube 接口响应，注入参数
http-response ^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch) script-path=https://raw.githubusercontent.com/guren777/Shadowrocket/refs/heads/main/youtube.response.js, requires-body=true, binary-body-mode=true, timeout=10, engine={engine}, tag=YouTube_Response_Modification, argument={"lyricLang":"{lyricLang}","captionLang":"{captionLang}","blockUpload":{blockUpload},"blockImmersive":{blockImmersive},"debug":{debug}}

[MITM]
# 启用中间人代理功能，确保脚本能拦截目标接口
hostname = %APPEND% *.googlevideo.com, youtubei.googleapis.com